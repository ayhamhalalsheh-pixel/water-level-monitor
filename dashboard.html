<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Water Tank Dashboard</title>
  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBKw3ywJDtI6bdzXWgG5mKotsq0NlMvOdI",
      authDomain: "wateresppro.firebaseapp.com",
      databaseURL: "https://wateresppro-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "wateresppro",
      storageBucket: "wateresppro.firebasestorage.app",
      messagingSenderId: "342671515655",
      appId: "1:342671515655:web:8890c1e7d597dd9a460aa2",
      measurementId: "G-CY55LPRKHF"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ✅ Get UID from URL
    const params = new URLSearchParams(window.location.search);
    const uid = params.get("uid");

    // ✅ Listen for water level updates
    const levelRef = ref(db, `${uid}/waterLevel`);
    const percentageText = document.getElementById("percentage");

    onValue(levelRef, (snapshot) => {
      const value = snapshot.val();
      if (value !== null) {
        percentageText.textContent = value + "%";
      } else {
        percentageText.textContent = "--%";
      }
    });
  </script>

  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at bottom, #001f3f, #00112b);
      font-family: "Poppins", sans-serif;
      color: white;
      overflow: hidden;
    }

    /* Company logo */
    .logo {
      position: absolute;
      top: 20px;
      font-size: 2em;
      font-weight: bold;
      color: #00aaff;
      letter-spacing: 3px;
      text-shadow: 0 0 15px #0088cc;
      font-family: "Segoe UI", sans-serif;
    }

    /* Water container */
    .tank {
      position: relative;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle at center, #0077ff 40%, #004488);
      box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.4), 0 0 40px rgba(0, 150, 255, 0.3);
      overflow: hidden;
    }

    /* Water animation */
    .wave {
      position: absolute;
      bottom: 0;
      width: 200%;
      height: 200%;
      background: rgba(173, 216, 230, 0.8);
      border-radius: 40%;
      animation: wave 4s infinite linear;
    }

    .wave:nth-child(2) {
      background: rgba(135, 206, 250, 0.7);
      animation-delay: -2s;
    }

    @keyframes wave {
      0% { transform: translateX(0) translateY(0); }
      50% { transform: translateX(-25%) translateY(10px); }
      100% { transform: translateX(-50%) translateY(0); }
    }

    /* Percentage text */
    #percentage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3em;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 10px rgba(255,255,255,0.8);
    }
  </style>
</head>

<body>
  <div class="logo">A+</div>

  <div class="tank">
    <div class="wave"></div>
    <div class="wave"></div>
    <div id="percentage">--%</div>
  </div>
</body>
</html>
